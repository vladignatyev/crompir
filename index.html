<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script type="text/javascript">


        crompir.imgs = [];



        crompir.Loader = function () {
            var myFiles;
            var myImages = [];
            var fileLoadingCursor;

            function recursivelyLoad() {
                if (fileLoadingCursor >= myFiles.length) {
                    for (var i = 0; i < myImages.length; i++) {
                        var img = crompir.resizeImage(myImages[i], {'newHeight': 200});
                        console.log(img);
                        $('body').append($(img[0]));
                    }
                    return;
                }

                var file = myFiles[fileLoadingCursor];
                var fr = new FileReader();

                function onload() {
                    var image = new Image();
                    image.onload = function (event) {
                        myImages.push(image);
                        recursivelyLoad();
                    };
                    image.src = fr.result;
                }

                fr.onload = onload;
                fr.readAsDataURL(file);
                fileLoadingCursor += 1;
            }

            this.load = function (files) {
                myFiles = files;
                fileLoadingCursor = 0;
                recursivelyLoad();
            };

            return this;
        };

        crompir.init = function ($el) {
            var input = $el.find('input[name=file]');
            var previewsPanel = $el.find('.previewPane');

            input.bind('change', function (event) {
                var files = event.target.files;
                var loader = new crompir.Loader();
                loader.load(files);
            });
        };


        $(document).ready(function () {
            crompir.init($('#crompir'))
        });
    </script>
</head>
<body>

<div id="crompir">
    <input name="file" type="file" multiple/>

    <canvas class="previewPane" style="position: absolute; width: 100%; height: 100px;"></canvas>
</div>


</body>
</html>
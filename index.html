<!DOCTYPE html>
<html>
<head>
    <title>crompir alpha</title>
    <script src="./js/jquery.min.js"></script>
    <script src="./js/jszip.js"></script>
    <script src="./js/jszip-inflate.js"></script>

    <link rel="stylesheet" type="text/css" href="./css/ui.css" />
    <script src="./js/crompir.js"></script>
    <script src="./js/ui.js"></script>

    <script type="text/javascript">
        var productImages = [];
        var sourceImages = [];

        function saveImages() {
            var zip = new JSZip();

            //processing
            $('#status').html('Processing...');
            for (var k = 0; k < sourceImages.length; k++) {
                productImages.push(crompir.processing.resizeImage(sourceImages[k].image, {'newWidth':400.0}));
            }
            $('#status').html('');

            console.log(productImages);
            //generating archive
            for (var i = 0; i < productImages.length; i++) {
                var savable = new Image();
                savable.src = productImages[i].toDataURL('image/jpeg');
                zip.file("img"+(i+1)+".jpg", savable.src.substr(savable.src.indexOf(',')+1), {base64:true});
            }

            location.href="data:application/zip;base64," + zip.generate();
        }

        $(document).ready(function () {
            $('input[name=file]').bind('change', function(event){
                var loader = new crompir.PreviewLoader();
                $(loader).bind('progress', function(event, data){
                    createImage(data.preview);
                });
                $(loader).bind('complete', function(event, data){
                    sourceImages = data.result;
                    console.log('source Imags');
                    console.log(sourceImages);
                    $('#save').bind('click', function(){
                        saveImages();
                    });
                    $('#save').show();
                });
                loader.load(event.target.files);
                console.log(event.target.files);
            });
        });
        $('#save').click(function(){
        });
    </script>
</head>
<body>
<div id="status"></div>
<div id="crompir">
    <input name="file" type="file" multiple/>
    <button id="save" style="display: none;">Save...</button>
</div>
<div class="tools">
    Поле со всякими функциональными кнопочками и переключателями.
    <div class="scale">
        Scale
        <span onclick="setScale(100)">small</span>
        <span onclick="setScale(150)">middle</span>
        <span onclick="setScale(200)">big</span>
    </div>
</div>
<div class="images"></div>

</body>
</html>